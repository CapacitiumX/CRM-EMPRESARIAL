<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CAPACITIUMX CRM - Private Edition</title>
    <style>
        :root { --primary: #1e3a8a; --bg: #f8fafc; --pros-color: #f59e0b; --sales-color: #10b981; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 15px; padding-bottom: 120px; }
        
        /* Caja Fuerte Estilo Bancario */
        .vault-card { 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); 
            color: white; padding: 20px; border-radius: 20px; margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .vault-title { color: #fbbf24; font-weight: 800; font-size: 0.9rem; margin-bottom: 15px; display: block; }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-v { padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; font-size: 0.75rem; }
        
        .dashboard { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 20px; }
        .dash-card { background: white; padding: 10px 5px; border-radius: 12px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .dash-num { font-size: 1.2rem; font-weight: 900; display: block; color: var(--primary); }
        .dash-label { font-size: 0.5rem; font-weight: bold; color: #64748b; text-transform: uppercase; }

        .client-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 12px; border-left: 6px solid #cbd5e1; }
        .status-prospecto { border-left-color: var(--pros-color); }
        .status-venta { border-left-color: var(--sales-color); }

        .fab { position: fixed; bottom: 25px; right: 25px; width: 65px; height: 65px; background: var(--primary); border-radius: 50%; color: white; border: none; font-size: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    </style>
</head>
<body>

    <div class="header" style="text-align:center; padding:10px;">
        <h2 style="margin:0; color:var(--primary); font-weight: 900;">CAPACITIUMX CRM</h2>
    </div>

    <div class="vault-card">
        <span class="vault-title">üîê CAJA FUERTE PRIVADA</span>
        <p style="font-size: 0.7rem; opacity: 0.8; margin-bottom: 15px;">Protege tu informaci√≥n con una contrase√±a propia.</p>
        
        <div class="btn-group">
            <button class="btn-v" style="background:#fbbf24; color:black;" onclick="exportWithPassword()">CREAR RESPALDO</button>
            <button class="btn-v" style="background:#10b981; color:white;" onclick="importWithPassword()">RESTAURAR ACCESO</button>
        </div>
    </div>

    <div class="dashboard">
        <div class="dash-card"><span class="dash-num" id="s-pros">0</span><span class="dash-label">Leads</span></div>
        <div class="dash-card"><span class="dash-num" id="s-sales">0</span><span class="dash-label">Ventas</span></div>
        <div class="dash-card"><span class="dash-num" id="s-lost">0</span><span class="dash-label">Perdido</span></div>
        <div class="dash-card"><span class="dash-num" id="s-total">0</span><span class="dash-label">Total</span></div>
    </div>

    <div id="list"></div>

    <button class="fab" onclick="alert('Usa el bot√≥n de Guardar en el formulario para a√±adir clientes.')">+</button>

    <script>
        let clients = JSON.parse(localStorage.getItem('crm_secure_v1')) || [];

        // --- FUNCI√ìN PARA QUE EL CLIENTE USE SU PROPIA CONTRASE√ëA ---
        function exportWithPassword() {
            if (clients.length === 0) return alert("No hay datos para guardar.");
            
            const pass = prompt("CREA TU CONTRASE√ëA PERSONAL:\n(Escribe algo que no olvides)");
            if (!pass) return;

            const dataStr = JSON.stringify(clients);
            // El secreto: Usamos su contrase√±a para "sellar" los datos
            const encrypted = btoa(unescape(encodeURIComponent(pass + "|" + dataStr)));
            
            const tempInput = document.createElement("textarea");
            document.body.appendChild(tempInput);
            tempInput.value = encrypted;
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);
            
            alert("‚úÖ ¬°RESPALDO CREADO!\n\nSe ha copiado una 'Llave' a tu portapapeles. Gu√°rdala en tus notas. Para abrirla despu√©s, el sistema te pedir√° la contrase√±a: " + pass);
        }

        function importWithPassword() {
            const key = prompt("PEGA AQU√ç TU LLAVE DE RESPALDO:");
            if (!key) return;

            const passAttempt = prompt("INGRESA TU CONTRASE√ëA PERSONAL PARA DESBLOQUEAR:");
            if (!passAttempt) return;

            try {
                const decoded = decodeURIComponent(escape(atob(key)));
                const parts = decoded.split("|");
                const originalPass = parts[0];
                const data = JSON.parse(parts[1]);

                if (passAttempt === originalPass) {
                    clients = data;
                    localStorage.setItem('crm_secure_v1', JSON.stringify(clients));
                    render();
                    alert("üéâ ¬°Acceso concedido! Datos restaurados.");
                } else {
                    alert("‚ùå Contrase√±a incorrecta. No puedes ver los datos.");
                }
            } catch (e) {
                alert("‚ùå Error: La llave no coincide o est√° da√±ada.");
            }
        }

        function render() {
            const list = document.getElementById('list');
            list.innerHTML = '';
            let p=0, v=0, l=0;
            clients.forEach(c => {
                if(c.status==='prospecto') p++; else if(c.status==='venta') v++; else l++;
                list.innerHTML += `<div class="client-card status-${c.status}"><b>${c.name}</b><br><small>${c.phone}</small></div>`;
            });
            document.getElementById('s-pros').innerText = p;
            document.getElementById('s-sales').innerText = v;
            document.getElementById('s-lost').innerText = l;
            document.getElementById('s-total').innerText = clients.length;
        }

        render();
    </script>
</body>
</html>
